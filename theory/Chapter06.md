# 6장 블록체인 구조

## 용어 및 팁

- 사토시 나카모토 의 논문: https://bitcoin.org/bitcoin.pdf
- 트랜젝션: 거래 처리 단위 , 1 거래 처리
- 블록을 생성하기 위한 요건 : 1 블록이 생성되는데 처리 시간이 10분이 되도록 자동 조정
- 비트코인이 채택한 작업 증명 방식(POW)는 Hashcash 방식
- Hashcash 방식의 요소 : 목표, 작업방식, 난이도 조정 방법, 난이도 조정 시점 이를 이용하여 작업을 증명함
  > ex) 
  > 목표: 2016개의 블록을 2주 동안 생성, 
  > 작업방식: 해시 값 찾기
  > 난이도 조정 방법: 목표치 도달 여부(초과/미달)
  > 난이도 조정 시점: 2016번째 블록
  > detail : 만약 연산 능력이 좋아서 1분에 하나씩 블록을 생성했다면 2016번째 블록은 예상 목표치인 2주일이 아니라 1.4일이 걸렸기 때문에 난이도는 10배로 늘어나게 된다.

----

## 비트코인의 구조

> A Purely peer-to-peer version of electronic cash would allow online payments to be sent directly from one party to another without going through a financial institution
> 전자 화폐를 순수 P2P(Peer to Peer)로 만들 수 있다면 금융 기관의 개입 없이 사용자 끼리 직접 온라인으로 지불할 수 있게 된다.

- 비트코인의 목적 : 은행과 같은 중앙 기관을 경유하지 않고 네트워크에서 1 대 1 교환이 가능한 전자 화폐 시스템을 구현하는 것
- 비트코인은 특정 역할을 집중해 담당하는 서버 같은 존재는 없다.
- 비트코인의 시스템 방식은 '분산형 시스템' 비트코인 네트워크의 참가자는 소유한 컴퓨터의 CPU 자원 등 하드웨어 자원을 서로 제공해 네트워크에서 마치 하나의 시스템의 일부인 것 처럼 작동한다.

## 비트코인의 구현 방법

**비트코인이 '온라인에서 교환이 가능한 전자 화폐'를 구현하기 위해 해결해야 하는 기술적 문제들**

1. 코인의 소유권 이전 과정에서 본인 보증과 부인 방지를 해야하기 때문에 전자 서명이란 방식을 사용해야한다.
2. 코인을 과거에 받고 사용했는데 사용한 이력 데이터를 로스(loss)하게 되어 이중으로 사용됬는지 파악하기 위해 블록체인이라는 대장에 기록하고 네트워크에서 공유한다. (해당 대장에 내역이 바뀌면 네트워크를 통해 모든 노드에게 전달 되기 때문에 로스하게 되어도 다른 노드가 원장에 기록하고 있다면 이중 사용에 대해 방지할 수 있다.)
3. 모두와 데이터를 공유한다고 하지만 변조는 막을 수 없다. 따라서 블록이라는 단위로 결합해 앞의 블록정보를 포함해 해시로 만들어 불가역 데이터를 만든다. 
4. 전체가 조작당하면 전체를 위조하고 조작할 수 있게 된다. 하지만 블록체인에서는 앞의 블록이 변조 당하면 뒤에 블록해시는 재 생성되게 되고 공격자는 매번 새로운 문제를 풀어야 한다. 그와 더불어 문제 푸는 난이도도 함께 올라간다. 또한 이 과정을 새로운 블럭이 만들어지기 전에 전체 블록의 난이도를 풀어야한다. 시스템상 변조를 하기위해 전체 블록의 문제를 모두 푸는것은 시스템 구조상 불가능에 가깝다.(하지만.. 또 모르지..? 답은 없지.)
5. 블록을 만드는데에 막대한 CPU 자원이 들어가게 된다. 좀 줄여야 한다. => 해결방안: 블록을 만든 사람에게 보상을 새로운 비트코인을 발행해 CPU 사용에 대한 인센티브를 제공
6. P2P 네트워크에서는 블록생성과 네트워크 전파 시점에 따라 블록체인이 분기하는 상황이 일어난다. => 해결방안: 체인이 분기하는 상황때 가장 긴 블록을 분기한다.

## 비잔티움 문제

> 블록체인에 자주 등장하는 용어가 될 텐데. 간단히 말해 A,B 국가가 있고 두 나라에서 전쟁을 하는데 A국가가 B나라를 치기위해 동맹국 C국한테 미리 '언제 어디서 B국을 칠태니 같이 쳐달라'라고 연락을 한다. 하지만 약속기간 당일 C국은 가지 않고 A국 혼자 B국과 전쟁을 한다라는 이야기.

비트코인 전에 P2P 네트워크간를 이용한 전자 화폐 시스템이 있었지만 이를 현실적으로 해결할 수 없었다. 이번장은 비트코인 이전에 전자 화폐 시스템에서 해결할 수 없었던 문제점을 거론하며 블록체인에 대해 이야기를 할것이다.

우선 이전 p2p 전자 화폐 시스템에 존재했었으며 현실적으로 해결이 불가능했던 문제들에 대해 언급하도록 한다.

1. 악의적 참가자에 의한 부정, 변조 : 누구나 참가할 수 있는 네트워크에 악의적인 참가자가 존재할 가능성이 있다. 의도적으로 부정 거래를 만들어 내거나 거래 결과를 자신에게 유리하도록 유리하게 변조할 가능성이 있다.(비잔티움 문제)

- 1. 문제 블록체인, PoW, 전자서명, 해답 인센티브 를 통해 해결책을 제시할 수 있다.

2. 정보 전달의 지연으로 인한 불일치 : 구체적으로는 실시된 거래 전달이 늦어져 다른 사람이 이중으로 처리하게 돼 이중 지불 같은 불일치 상태가 발생할 수 있다

3. 네트워크를 자율적으로 유지 또는 운영하기 위한 추진력 : 누구나 참여할 수 있다는 것은 반대로 말하면 책임 지는 관리자가 없다는 것이므로 시스템 품질(복원성, 가용성)을 유지하면서 운영해 나갈 수 있는 추진력이 없다.

## 비트코인의 처리 흐름

1. 블록체인 네트워크 참가자로서 계좌를 사용하는 사용자 A~F와 블록을 만드는 승인자(채굴자)가 있는 구성을 가정한다.

2. 사용자 A,B,E 가 송금을 의뢰(트랜젝션)한다. 트랜젝션을 발행할 때 본인 확인을 위한 전자 서명을 첨부한다.

3. 발행된 트랜잭션은 P2P 네트워크를 통해 참가자 전원(승인자들)에게 브로드 캐스트 된다.

4. 트랜잭션을 받은 승인자는 전자서명을 확인하고 블록을 생성하기 위한 요건을 만족시키는 '해답'을 찾기 시킨다.

5. 처음 조건을 만족하는 해답을 발견한 승인자(채굴자)는 생성한 블록을 참가자 전원에게 브로드 캐스트 한다.

6. 블록을 받은 각 노드는 정당한 블록인지 검증한다. 구체적으로는 이전 블록 정보+해답을 매개변수로 해시값을 구해 조건을 만족하는지 확인한다. 조건을 만족한다면 수신한 블록을 자신의 로컬 디스크에 있는 블록체인에 추가한다.

## 비트코인 이외의 블록체인 기반 기술

비트코인에서 사용되는 기술은 실제로 통화 시스템에 특화된 구조가 아닌 '분산된 네트워크 환경에서 오직 하나의 정보를 공유하고 그 정보를 바탕으로 어떤 처리를 하는' 지극히 일반적인 개념을 실용화한 것이라고 할 수 있다.

하지만 비트코인은 전자 화폐 시스템으로 탄생했기 때문에 역시 데이터 구조나 프로토콜은 화폐시스템에 특화돼 있다. 시스템 자체는 범용적이지만 그곳에 흐르는 데이터와 처리를 다른 방법으로 사용하는 데에는 한계가 있다.

## 대표적인 블록체인 기반 

Todo... 테이블..... 잘못 복붙함.


## 블록체인 기술 구성 요소

> 블록체인 기술  = [스마트 계약, 전자서명과 해시함수, 합의 알고리즘]
> P2P 네트워크

- **스마트 계약:** 앞서 다룬 스마트 계약과는 달리 블록체인 네트워크에서 동작하는 프로그램을 가리킨다. 블록체인 기반 기술 중에서 가장 자유도가 높은 프로그램을 만들 수 있다.

- **전자서명과 해시 함수:** 트랜잭션(거래)을 발생시킨 사람의 정당성을 보증하거나 거래와 블록체인의 변조 방지 그리고 암호화 등 보안과 관련된 기능이다.

- **합의 알고리즘:** P2P 네트워크와 같은 분산 네트워크에서 합의 형성을 수행하기 위한 알고리즘이다. 블록체인을 여러 노드에서 공유하기 위한 가장 중요한 구조라고 할 수 있다.


## 블록체인 기반 기술의 분류

블록체인은 용도와 적용되는 네트워크 종류에 따라 몇 개의 패턴이 존재한다. 또한 블록체인 기반은 각각 어떤 패턴을 지향하고 있느냐에 따라 대략적인 분류가 가능하다. 우선 크게 나누면 누구나 참여 가능한가, 신뢰하는 참가자로만 제한하느냐로 나눌 수 있다.  후자는 블록의 생성(마이닝) 이나 블록체인의 참조를 제한 할 수 있다.

Todo 테이블 ..

이때 비트코인은 공용형, 엔터프라이즈 이용은 컨소시엄형이 유력시 된다.


## 블록체인 기반 기술 비교 

p92 참조

## 데이터 모델 비교

p93 참조







