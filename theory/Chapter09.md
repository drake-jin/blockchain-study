# 9장 전자 서명과 해시

블록체인의 위조나 변조 방지는 알려진 암호화 기술인 전자 서명과 해시를 조합해 구현하고 있다.
이번 장에서는 블록체인에 채택된 암호화 기술의 개요와 그것이 블록체인에서 어떻게 이용되고 있는지에 대해 소개한다.

## 용어 및 팁

- ECDSA: 타원곡선상의 이산 대수 문제의 어려움에 기초한 암호 시스템. RSA에서는 2048비트를 필요로 하는 암호화 강도를 224~255비트로 구현할 수 있다.

## 전자 서명을 통한 위조 및 변조 방지


## 전자 서명 개요

- 전자 서명은 전자 데이터의 타당성을 증명하는 것이다.
- 전자 데이터를 보내는 사람이 서명을 생성하고 받는 사람은 그 서명을 검증해 타인에 의한 위조나 변조가 이루어졌는지를 확인할 수 있다.

1. 보내는 사람은 받는 사람에게 보내는 사람의 비밀키로 공개키를 만들어 공개키를 전송한다.
2. 보내는 사람은 payload를 비밀키로 암호화(전자서명)을 하여 받는 사람에게 암호화한 payload(전자서명)와 payload를 함께 전송한다.
3. 받는 사람은 암호화한 payload(전자서명)를 공개키로 복호화해서 payload값을 획득한다.
4. 전자서명을 복호화 해서 얻은 payload값과 그냥 받은 payload값을 대조하여 보내는 사람의 payload가 유효함을 증명한다.

- 블록체인은 전자 서명에 의해 트랜잭션의 정당성을 보증한다
- 여기서 말하는 '트랜젝션'은 비트코인의 '거래(~~에게 송금함)'과 같은 정보이다
- 다른 블록체인 기반 기술로 구현한 스마트 계약 이라면 게약 조건에 맞았을 때 집행할 계약 내용이 된다.
- 보낸 사람만 알고 있는 비밀키로 암호문을 생성하기 때문에 그 암호문이 서명으로서의 의미를 가진다.
- 또한 그 서명을 검증하기 위한 공개키는 공개 됐기 때문에 누구나 서명을 검증할 수 있다. 

## 블록체인에서의 전자 서명

- 블록체인에서는 각 트랜젝션에 한 개씩 전자 서명이 부여된다.
- 블록체인에서는 전자 서명을 검증하기 위한 공개키도 세트로 부여된다.
- 블록체인이기 때문에 이전 트랜젝션에서 사용한 비밀키를 이용해 다음 트랜젝션의 서명을 만든다.
- 비트코인의 블록체인 시스템에서는 발행된 모든 트랜잭션이 저장되 있으며 각 트랜젝션에 전자 서명과 공개키가 세트로 부여되어 있다.
- 즉, 비트코인 네트워크의 참가자는 과거 블록체인상에서 수행된 모든 트랜잭션을 순차 검증할 수 있다.
- 트랜젝션의 전자 서명을 검증하면 공격자의 위.변조, 도용, 위장에 대한 여부를 알 수 있다.
- 블록체인 기반 기술에서는 키 쌍 생성의 타원 곡선 암호(ECDSA) 라는 알고리즘을 사용해 키 길이는 256비트 이상을 사용한다.
- RSA나 ElGamel암호 등 다른 방식과 동등한 수준의 암호 강도를 보다 짧은 키를 사용해 구현할 수 있으며 결과적으로 처리 성능을 빠르게 할 수 있다.

## 해시를 통한 위조 및 변조 방지

## 해시 개요

- 해시는 전자 서명과 마찬가지로 전자 데이터로부터 생성되는 값이다.
- 전자 서명과의 차이점은 생성된 해시는 다시 원래 데이터로 변환 할 수 없다
- 전자 데이터를 이용해 해시를 만들 수는 있지만 해시로 부터 원본 전자 데이터를 만들어 내는것은 불가능함
- 때문에 해시는 지문으로 비유된다
- 지문은 사람이 가진 고유한 패턴으로 인식되듯이 해시는 해당 데이터가 가진 고유한 패턴으로 인식되기 때문이다
- 이 특성을 이용해 해시를 비교하면 전자 데이터의 위조 및 변조 여부를 확인할 수 있다.
- 해시 함수는 전자 데이터의 해시를 생성하는 함수
- 해시충돌이 존재할 경우는 0은 아님, 해시크기가 2비트면 4가지 해시값만 표현할 수 있기 때문애 payload값이 5종류 이상이라면 충돌이 발생하게 됨
- 비트코인에서 채택하고 있는 SHA-256 해시 함수는 256비트의 해시값을 생성한다.
- 256비트로 표현 가능한 해시 수는 천문학적이기 때문에 해시 값이 충돌할 확률은 무시할 수 있을 만큼 작다


## 해시함수의 특징
- 전자 데이터의 고유한 해시를 생성함
- 전자 데이터의 길이(비트 길이)와 상관없이 고정된 크기의 해시를 생성함 (해시 사이즈는 사용하는 해시 함수가 결정)
- 전자 데이터가 1비트라도 변하면 완전히 다른 해시가 만들어짐(해시는 전자 데이터의 내용에 따라 고유한 값을 가지기 때문)


## 비트코인의 블록체인에서 해시 이용

- 블록체인은 복수의 트랜잭션을 모은 블록을 만든다. 
- 새로 생성된 블록에는 이전 해시를 포함시킨다
- 해시 계산에서 사용하는 Nonce(해답) 이라는 값을 세트로 첨부 한다.
- 비트코인에서 블록생성은 '블록 헤더 + 트랜젝션 정보(복수)'로 만들어지며 블록 헤더는 '이전 블록 헤더의 해시 값 + Nonce + 트랜젝션의 해시값'으로 구성된다.
- 블록을 생성하려면 1개 앞의 블록 헤더의 정보와 생성한 Nonce 및 그 블록에 포함된 모든 트랜젝션의 해시값을 포함시켜 해시 함수에 입력한다.
- 그렇기 때문에 어떤 블록의 내용을 위조하거나 변조하면 해시 함수의 특성에 다라 그 다음 블록에 포함된 해시값이 변하며 동시에 이후의 모든 블록에 포함된 해시값이 변한다.
- 공격자는 위조나 변조를 성공시키기 위해서는 이런 모든 해시를 다시 계산하지 않으면 안된다.

## 블록체인의 해싱, 암호 기술로서의 향후 과제

- 블록체인에서 사용하고 있는 암호화 기술은 이미 오래전 부터 존재해오던 것이며, 다양한 분야에서 이용되고 있기 때문에 충분히 검증된 것이다.
- 하지만 블록체인 기술에서 이용하기 위한 유효성이 충분히 검증된 것은 아니다. 

1. [트랜잭션 전성 문제](http://www.coindesk.com/bitcoin-bug-guide-transaction-malleability)

xmfpswprtus

2. 


